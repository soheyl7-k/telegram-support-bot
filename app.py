import os
import telebot
from flask import Flask
from threading import Thread

# گرفتن توکن ربات از متغیر محیطی
TOKEN = os.getenv("TELEGRAM_TOKEN")  # متغیر محیطی TELEGRAM_TOKEN در سرور تنظیم می‌شود
bot = telebot.TeleBot(TOKEN)

# تابع برای پاسخ خودکار به همه پیام‌ها
@bot.message_handler(func=lambda message: True)
def auto_reply(message):
    response = """
سلام دوست عزیز، وقت شما بخیر 🌹
اگر در فرآیند استفاده از سایت یا محصولات ما به مشکلی برخورد کرده‌اید، لطفاً این نکات را بررسی کنید:
1️⃣ مشکل در دریافت پیامک ورود به سایت: اگر پیامک ورود به حساب کاربری را دریافت نکرده‌اید، ممکن است به پوشه اسپم یا تبلیغات رفته باشد. لطفاً آنجا را هم بررسی کنید.
2️⃣ نحوه خرید دوره‌ها: در صورت نیاز به راهنمای خرید، می‌توانید از این لینک استفاده کنید: [لینک مقاله خرید دوره].
3️⃣ استفاده از اسپات پلیر: برای دسترسی به دوره‌ها، باید اسپات پلیر را نصب کنید. راهنمای کامل استفاده از آن اینجاست: [لینک مقاله اسپات پلیر].
4️⃣ مشکل در دانلود فایل‌ها: اگر در دانلود فایل‌ها یا باز کردن آنها به مشکلی برخوردید، لطفاً این راهنما را بررسی کنید: [لینک مقاله مشکلات دانلود].
5️⃣ وضعیت ارسال کتاب‌ها: اگر کتاب خریداری‌شده شما هنوز به دستتان نرسیده، لطفاً شماره سفارش خود را برای ما ارسال کنید تا وضعیت سفارش شما بررسی شود.
6️⃣ مشکل در پرداخت: اگر پرداخت شما ناموفق بوده یا مبلغ از حسابتان کم شده، لطفاً اطلاعات تراکنش را برای ما ارسال کنید تا بررسی کنیم.
7️⃣ سطح دوره‌های آموزشی: توضیحات کاملی درباره سطح هر دوره آماده شده است که می‌توانید اینجا مشاهده کنید: [لینک مقاله سطح دوره‌ها].
8️⃣ استفاده از کد تخفیف: اگر هنگام وارد کردن کد تخفیف به مشکلی برخوردید، لطفاً از این راهنما استفاده کنید: [لینک مقاله کد تخفیف].
9️⃣ نسخه الکترونیکی کتاب: اگر نسخه الکترونیکی کتاب خود را پیدا نکردید یا مشکلی در دانلود دارید، لطفاً این راهنما را بررسی کنید: [لینک مقاله دانلود کتاب].
🔟 تماس با پشتیبانی: اگر مشکل شما هیچ‌کدام از این موارد نیست، درخواست خود را برای ما ارسال کنید. همکاران ما در کوتاه‌ترین زمان ممکن بررسی خواهند کرد و با شما تماس می‌گیرند.
ما همیشه آماده پاسخ‌گویی به شما هستیم و امیدواریم تجربه‌ای عالی داشته باشید.
با احترام، سهیل کیانی 🌟
    """
    bot.reply_to(message, response)

# ایجاد یک سرور Flask
app = Flask(__name__)

@app.route('/')
def home():
    return "Bot is running!"

# اجرای ربات تلگرام در یک Thread جداگانه
def run_bot():
    print("ربات در حال اجراست...")
    bot.infinity_polling()

if __name__ == "__main__":
    # اجرای بات تلگرام در رشته جداگانه
    bot_thread = Thread(target=run_bot)
    bot_thread.start()

    # اجرای سرور Flask روی پورت موردنیاز Render
    app.run(host="0.0.0.0", port=10000)
